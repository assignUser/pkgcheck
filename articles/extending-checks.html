<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Extending or modifying checks • pkgcheck</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Extending or modifying checks">
<meta property="og:description" content="pkgcheck">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pkgcheck</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1.410</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/extending-checks.html">Extending or modifying checks</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropensci-review-tools/pkgcheck/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="extending-checks_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Extending or modifying checks</h1>
                        <h4 class="author">Mark Padgham</h4>
            
            <h4 class="date">2021-09-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci-review-tools/pkgcheck/blob/master/vignettes/extending-checks.Rmd"><code>vignettes/extending-checks.Rmd</code></a></small>
      <div class="hidden name"><code>extending-checks.Rmd</code></div>

    </div>

    
    
<p>This vignette describes how to modify or extend the existing suite of checks performed by <code>pkgcheck</code>. It is primarily based around the example of the <a href="https://github.com/ropensci-review-tools/pkgcheck/blob/d02dcb630e5f38f599b6186580001510ffc5b314/R/misc-checks.R#L347-L368"><code>pkg_has_scrap()</code> function</a> contributed by Maëlle Salmon (<a href="https://github.com/maelle">@maelle</a>) via <a href="https://github.com/ropensci-review-tools/pkgcheck/pull/27">this pull request</a>.</p>
<div id="create-a-new-check" class="section level2">
<h2 class="hasAnchor">
<a href="#create-a-new-check" class="anchor"></a>1. Create a new check</h2>
<p>New checks can be placed anywhere within the current code, including in new files within the <code>R</code> directory. The <a href="https://github.com/ropensci-review-tools/pkgcheck/blob/d02dcb630e5f38f599b6186580001510ffc5b314/R/misc-checks.R#L347-L368"><code>pkg_has_scrap()</code> function</a> is relatively short, and so was appended to the <a href="https://github.com/ropensci-review-tools/pkgcheck/blob/main/R/misc-checks.R"><code>R/misc-checks.R</code> file</a>. Importantly check functions may not return <code>NULL</code>. If a <code>NULL</code>-like return value is desired, it should be a zero-length vector of appropriate type. For example, the <a href="https://github.com/ropensci-review-tools/pkgcheck/blob/d02dcb630e5f38f599b6186580001510ffc5b314/R/misc-checks.R#L347-L368"><code>pkg_has_scrap()</code> function</a> returns the names of any “scrap” files included within a git repository (implying files that should generally not be committed and included). If none are included, the function returns <code><a href="https://rdrr.io/r/base/character.html">character(0)</a></code> and not <code>NULL</code>.</p>
<p>The values returned are used to construct messages issued by <code>pkgcheck</code> in response to these checks, so it is generally better to return actual values, rather than generic <code>TRUE</code>, <code>FALSE</code>, or other symbolic values. This point is illustrated below in the demonstration of the <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> method.</p>
</div>
<div id="add-check-function-to-pkgcheck-output" class="section level2">
<h2 class="hasAnchor">
<a href="#add-check-function-to-pkgcheck-output" class="anchor"></a>2. Add check function to <code>pkgcheck</code> output</h2>
<p>A new check function can be added to the result returned by <a href="https://github.com/ropensci-review-tools/pkgcheck/blob/main/R/pkgcheck-fn.R">the <code>pkgcheck()</code> function</a> by inserting it below the commented line, <code># ----- Add new checks here ---</code>. The <code>pkg_has_scrap()</code> function is included within that section to illustrate. New checks inserted in that location will by default appear in a “Miscellaneous checks” section of the report. Checks may be inserted in other locations by inserting them elsewhere within the sequence specified in this <a href="https://github.com/ropensci-review-tools/pkgcheck/blob/main/R/pkgcheck-fn.R">main <code>pkgcheck()</code> function</a>.</p>
</div>
<div id="modify-tests-to-include-new-check" class="section level2">
<h2 class="hasAnchor">
<a href="#modify-tests-to-include-new-check" class="anchor"></a>3. Modify tests to include new check</h2>
<p>Tests may be updated as soon as new items are returned by the <a href="https://github.com/ropensci-review-tools/pkgcheck/blob/main/R/pkgcheck-fn.R">main <code>pkgcheck()</code> function</a>. This generally requires the two simple modifications of:</p>
<ol style="list-style-type: decimal">
<li>Adding the name of the new test to the <a href="https://github.com/ropensci-review-tools/pkgcheck/blob/a3507752b00b2206aee34ecbe99424d4cadb59f8/tests/testthat/test-pkgcheck.R#L19-L33">list of “items” expected in the result of the main <code>pkgcheck</code> call</a>.</li>
<li>Increase the <a href="https://github.com/ropensci-review-tools/pkgcheck/blob/a3507752b00b2206aee34ecbe99424d4cadb59f8/tests/testthat/test-bg.R#L29">expected length of the result of <code>pkgcheck()</code></a> by one for each new test. The expected length is currently 15.</li>
</ol>
</div>
<div id="add-check-result-to-summary-output" class="section level2">
<h2 class="hasAnchor">
<a href="#add-check-result-to-summary-output" class="anchor"></a>4. Add check result to summary output</h2>
<p>All <code>pkgcheck</code> objects have a <code>summary</code> method which generates the screen print indicating whether or not all expected checks have been passed, and whether or not a package is ready to be submitted for peer review to rOpenSci. The printed summary is first generated by a function called <a href="https://github.com/ropensci-review-tools/pkgcheck/blob/main/R/collate-checks.R"><code>collate_checks()</code></a>, which calls a series of sub-functions, generally one for each kind of check. New checks require new sub-functions, as can be seen by <a href="https://github.com/ropensci-review-tools/pkgcheck/blob/a3507752b00b2206aee34ecbe99424d4cadb59f8/R/collate-checks.R#L29">the call to <code>collate_scrap_checks (checks)</code></a>. New “collate” methods should all be inserted within this single <a href="https://github.com/ropensci-review-tools/pkgcheck/blob/main/R/collate-checks.R"><code>collate-checks.R</code> file</a>, and should be prefixed with <code>collate_</code>.</p>
<p>A collate method must begin within a least two <a href="https://roxygen2.r-lib.org"><code>roxygen2</code> comment lines</a>, the second of which is <code>#' @noRd</code> to suppress translation to a documentation (<code>.Rd</code>) file. The first of these is explained at the top of that file, and should be either</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' @return Tick or cross</span></code></pre></div>
<p>or,</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' @return Cross only</span></code></pre></div>
<p>(with optional additional explanatory text). The first option is generally used for more important tests, and indicates that a green tick or red cross will appear to indicate that the test is respectively either passed or failed. Some tests only prompt a red cross when they fail, and do not appear in the summary list when they pass. These specify return values with the second option, <code>#' @return Cross only</code>.</p>
<p>The <a href="https://github.com/ropensci-review-tools/pkgcheck/blob/a3507752b00b2206aee34ecbe99424d4cadb59f8/R/collate-checks.R#L310-L323"><code>collate_scrap_checks()</code> function</a> has “Cross only”, and returns <code>NULL</code> is the test is passed. If the test is failed, it appends a simple message to the initial symbols, <code><a href="https://rdrr.io/r/base/paste.html">paste0 ("-", symbol_crs ())</a></code>, where <code>symbol_crs()</code> encodes the red cross, and <code>symbol_tck()</code> the green tick for passing checks. The message should generally be short and simple. Full information returned from the actual check function should generally be used only in the <code>print</code> method (described below), and not in the <code>summary</code> method.</p>
<p>Finally, the name of the sub-function should then be added to the sequence of function calls in the main <a href="https://github.com/ropensci-review-tools/pkgcheck/blob/main/R/collate-checks.R"><code>collate_checks()</code> function</a>, in which the section of “Miscellaneous Checks” is clearly indicated.</p>
</div>
<div id="add-new-check-result-to-print-output" class="section level2">
<h2 class="hasAnchor">
<a href="#add-new-check-result-to-print-output" class="anchor"></a>5. Add new check result to print output</h2>
<p>As described above, summary checks generally only print a short, fixed message indicating whether or test a check has been passed. Detailed returns by the actual check function are generally only shown via the <a href="https://github.com/ropensci-review-tools/pkgcheck/blob/main/R/pkgcheck-methods.R"><code>print</code> method</a> associated with <code>pkgcheck</code> objects. The <code>print</code> method for any new check items is generally implemented by constructing an associated function; the <code>pkg_has_scrap()</code> function, for example, is called <a href="https://github.com/ropensci-review-tools/pkgcheck/blob/a3507752b00b2206aee34ecbe99424d4cadb59f8/R/pkgcheck-methods.R#L183-L192"><code>print_scrap()</code></a>. That function demonstrates that all output uses the <a href="https://cli.r-lib.org"><code>cli</code> package</a>, including in this example the <a href="https://cli.r-lib.org/reference/cli_li.html">“list item” function (<code>cli_li</code>)</a>.</p>
<p>The <code>print</code> methods generally hand-code the different responses for passing and failing checks. The <a href="https://github.com/ropensci-review-tools/pkgcheck/blob/d02dcb630e5f38f599b6186580001510ffc5b314/R/misc-checks.R#L347-L368"><code>pkg_has_scrap()</code> function</a> only returns values when it fails, so only requires a <code>print</code> method on check failures. The pass (tick) and fail (cross) symbols are translated into corresponding <code>cli</code> symbols as follows:</p>
<table class="table">
<thead><tr class="header">
<th>
<code>summary</code> symbol</th>
<th>
<code>print</code> symbol</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>symbol_crs()</td>
<td>cli::cli_alert_danger()</td>
</tr>
<tr class="even">
<td>symbol_tck()</td>
<td>cli::cli_alert_success()</td>
</tr>
</tbody>
</table>
<p>See other functions in the main <a href="https://github.com/ropensci-review-tools/pkgcheck/blob/main/R/pkgcheck-methods.R"><code>pgkcheck-methods.R</code> file</a> for examples. And that is all the steps required to add a new check.</p>
</div>
<div id="convert-new-check-result-to-markdown-output" class="section level2">
<h2 class="hasAnchor">
<a href="#convert-new-check-result-to-markdown-output" class="anchor"></a>6. Convert new check result to markdown output</h2>
<p>The <code>summary</code> and <code>print</code> methods described above are used to control the appearance of checks on local terminal screens. The <code>pkgcheck</code> package also includes a function to convert checks to markdown format, the most important purpose of which is to render the checks for inserting within GitHub issues. For any new checks to appear in the reports generated by <code>ropensci-review-bot</code>, they need to be added to the <a href="https://github.com/ropensci-review-tools/pkgcheck/blob/main/R/format-checks.R"><code>checks_to_markdown()</code> function</a>. The place to insert new functions is indicated in the <code><a href="../reference/checks_to_markdown.html">checks_to_markdown()</a></code> function by the comment line, <code># ----- Add new checks here ----</code>, similar to how new checks are added to the main <code>pgkcheck()</code> function described in the second section above.</p>
<p>The format of these functions is best illustrated by example, with the conversion function for the scrap checks looking like this:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scrap_checks_md</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">checks</span><span class="op">)</span> <span class="op">{</span>

    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span> <span class="op">(</span><span class="va">checks</span><span class="op">$</span><span class="va">scrap</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0L</span><span class="op">)</span>
        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span> <span class="op">(</span><span class="cn">NULL</span><span class="op">)</span>

    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span> <span class="op">(</span><span class="st">""</span>,
       <span class="st">":heavy_check_mark: Package contains the following unexpected files:"</span>,
       <span class="st">""</span>,
       <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span> <span class="op">(</span><span class="st">"- "</span>, <span class="va">checks</span><span class="op">$</span><span class="va">scrap</span><span class="op">)</span>,
       <span class="st">""</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>This function returns nothing if there are no scrap files, as specified by the <code>roxygen2</code> comments of <code>#' @return cross only</code> in the corresponding function in <a href="https://github.com/ropensci-review-tools/pkgcheck/blob/main/R/collate-checks.R">the <code>collate_checks.R</code> file</a>), described in section 4, above. Packages which contain scrap files will then produce the message specified by that function, including the name of each scrap file as a list item.</p>
<p>Any new functions must ensure that they return <code>NULL</code> when the nominated component of the <code>checks</code> list is itself <code>NULL</code> – do not presume that components processed within a given markdown conversion function actually exist. Note also that the text output of these markdown-formatted checks generally starts and ends with a blank line (<code>""</code>). These lines are important to ensure appropriate rendering of HTML components.</p>
<p>Finally, note that the green ticks and red crosses need to be converted to a different format, using the following markdown conversions:</p>
<table class="table">
<thead><tr class="header">
<th>
<code>summary</code> symbol</th>
<th>markdown symbol</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>symbol_crs()</td>
<td>:heavy_multiplication_x:</td>
</tr>
<tr class="even">
<td>symbol_tck()</td>
<td>:heavy_check_mark:</td>
</tr>
</tbody>
</table>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Mark Padgham.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
